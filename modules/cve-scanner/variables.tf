# CVE Scanner Wrapper Module Variables
#
# Simplified interface for complete CVE Scanner deployment.
# This module wraps principal-charm-cos and cve-scanner-config modules.

variable "model_name" {
  description = "Juju model name for CVE Scanner deployment"
  type        = string
  validation {
    condition     = can(regex("^[a-z0-9-]+$", var.model_name))
    error_message = "Model name must contain only lowercase letters, numbers, and hyphens"
  }
}

variable "cloud_name" {
  description = "Juju cloud name (e.g., localhost, aws, maas-cloud)"
  type        = string
  default     = "localhost"
}

variable "cloud_region" {
  description = "Cloud region for model deployment"
  type        = string
  default     = "localhost"
}

variable "charm_source" {
  description = "Charm deployment source: 'charmhub' or 'local'"
  type        = string
  validation {
    condition     = contains(["charmhub", "local"], var.charm_source)
    error_message = "charm-source must be either 'charmhub' or 'local'"
  }
}

variable "charm_path" {
  description = "Path to local .charm file (required if charm-source='local'). Can be downloaded from GitHub releases."
  type        = string
  default     = null
}

variable "charm_name" {
  description = "Charm name (CharmHub identifier or local charm name)"
  type        = string
  default     = "cve-scanner"
}

variable "charm_channel" {
  description = "CharmHub channel (e.g., latest/stable, latest/edge)"
  type        = string
  default     = "latest/stable"
}

variable "landscape_api_uri" {
  description = "Landscape Server API URI (e.g., https://landscape.canonical.com/api/)"
  type        = string
}

variable "landscape_api_key_value" {
  description = "Landscape API key value (stored as Juju secret). Recommended: use TF_VAR_landscape_api_key_value environment variable."
  type        = string
  sensitive   = true
}

variable "landscape_api_secret_value" {
  description = "Landscape API secret value (stored as Juju secret). Recommended: use TF_VAR_landscape_api_secret_value environment variable."
  type        = string
  sensitive   = true
}

variable "snap_resource_path" {
  description = "Path to local cve-scanner.snap file for resource attachment. Can be downloaded from GitHub releases."
  type        = string
  default     = ""
}

variable "landscape_ca_cert" {
  description = "Landscape CA certificate content for self-signed servers (optional)"
  type        = string
  default     = ""
}

variable "enable_cos_integration" {
  description = "Enable COS integration: deploys grafana-agent and creates cross-model relations"
  type        = bool
  default     = true
}

variable "grafana_agent_channel" {
  description = "CharmHub channel for grafana-agent"
  type        = string
  default     = "1/stable"
}

variable "prometheus_offer_url" {
  description = "Prometheus offer URL (format: controller:owner/model.app:endpoint)"
  type        = string
  default     = ""
}

variable "loki_offer_url" {
  description = "Loki offer URL (format: controller:owner/model.app:endpoint)"
  type        = string
  default     = ""
}

variable "grafana_offer_url" {
  description = "Grafana offer URL (format: controller:owner/model.app:endpoint)"
  type        = string
  default     = ""
}

variable "app_name" {
  description = "Juju application name for the CVE Scanner"
  type        = string
  default     = "cve-scanner"
  validation {
    condition     = can(regex("^[a-z0-9-]+$", var.app_name))
    error_message = "Application name must contain only lowercase letters, numbers, and hyphens"
  }
}

variable "units" {
  description = "Number of application units"
  type        = number
  default     = 1
  validation {
    condition     = var.units >= 1
    error_message = "Must deploy at least 1 unit"
  }
}

variable "base" {
  description = "Base OS version (e.g., 'ubuntu@22.04', 'ubuntu@24.04')"
  type        = string
  default     = "ubuntu@24.04"
  validation {
    condition     = can(regex("^ubuntu@[0-9]{2}\\.[0-9]{2}$", var.base))
    error_message = "Base must be in format 'ubuntu@XX.YY'"
  }
}

variable "constraints" {
  description = "Juju constraints (e.g., 'mem=4G cores=2')"
  type        = string
  default     = ""
}

variable "manage_secrets" {
  description = "Create and manage Juju secrets via Terraform for Landscape credentials"
  type        = bool
  default     = true
}
